<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ch·ªânh s·ª≠a ·∫£nh</title>

  <!-- Font & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Caveat:wght@700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

  <!-- Style -->
  <link rel="stylesheet" href="style.css" />

  <!-- TensorFlow.js & COCO-SSD -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

  <!-- Tesseract.js for OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>

  <style>
    .big-welcome {
      position: absolute;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Caveat', cursive;
      font-size: clamp(3rem, 14vw, 8rem);
      color: #f497b6;
      opacity: 0.15;
      white-space: nowrap;
      z-index: 0;
      pointer-events: none;
      user-select: none;
    }
    .glass-box {
      position: relative;
      z-index: 2;
    }
    #ocrResult {
      white-space: pre-line;
      margin-top: 1rem;
      font-family: monospace;
      background: #f9f9f9;
      padding: 1rem;
      border-radius: 10px;
      color: #222;
      max-width: 600px;
      border-left: 5px solid #f38db3;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
  </style>
</head>

<body>
  <!-- Ch·ªØ welcome l·ªõn -->
  <div class="big-welcome">WELCOME</div>

  <!-- Giao di·ªán ch√†o -->
  <section class="hero" id="hero">
    <div class="glass-box">
      <h1>Ch·ªânh s·ª≠a ·∫£nh online</h1>
      <p>T·ª´ thao t√°c c∆° b·∫£n ƒë·∫øn ph√¢n t√≠ch ·∫£nh b·∫±ng tr√≠ tu·ªá nh√¢n t·∫°o ‚Äì t·∫•t c·∫£ ƒë·ªÅu th·ª±c hi·ªán ngay tr√™n tr√¨nh duy·ªát c·ªßa b·∫°n.</p>
      <label for="upload" class="upload-btn">
        <i class="bi bi-upload"></i> T·∫£i l√™n h√¨nh ·∫£nh
      </label>
      <input type="file" id="upload" accept="image/*" hidden />
    </div>
  </section>

  <!-- Giao di·ªán ch·ªânh s·ª≠a -->
  <section class="editor" id="editor" style="display: none;">
    <div class="canvas-group">
      <div style="position: relative; display: inline-block;">
        <canvas id="canvas"></canvas>
        <canvas id="overlay" style="position: absolute; top: 0; left: 0; pointer-events: none;"></canvas>
      </div>

      <div class="tools">
        <button class="btn" onclick="applyEdit('rotate')">
          <i class="bi bi-arrow-clockwise"></i> Xoay 90¬∞
        </button>
        <button class="btn" onclick="applyEdit('brighten')">
          <i class="bi bi-brightness-high"></i> TƒÉng s√°ng
        </button>
        <button class="btn" onclick="applyEdit('darken')">
          <i class="bi bi-moon-stars"></i> Gi·∫£m s√°ng
        </button>
        <button class="btn" onclick="applyEdit('sobelX')">
          <i class="bi bi-border-top"></i> Sobel X
        </button>
        <button class="btn" onclick="applyEdit('sobelY')">
          <i class="bi bi-border-left"></i> Sobel Y
        </button>
        <button class="btn" onclick="detectObjects()">
          <i class="bi bi-bounding-box"></i> Ph√°t hi·ªán ƒë·ªëi t∆∞·ª£ng
        </button>
        <button class="btn" onclick="performOCR()">
          <i class="bi bi-file-earmark-text"></i> ƒê·ªçc vƒÉn b·∫£n
        </button>
        <button class="btn outline" onclick="applyEdit('reset')">
          <i class="bi bi-arrow-counterclockwise"></i> Kh√¥i ph·ª•c
        </button>
        <label class="btn outline">
          <i class="bi bi-image"></i> ƒê·ªïi ·∫£nh
          <input type="file" id="uploadAgain" accept="image/*" hidden />
        </label>
      </div>

      <!-- K·∫øt qu·∫£ OCR hi·ªÉn th·ªã ·ªü ƒë√¢y -->
      <div id="ocrResult"></div>
    </div>
  </section>

  <!-- Script ch√≠nh -->
  <script src="script.js"></script>

  <!-- X·ª≠ l√Ω ph√°t hi·ªán ƒë·ªëi t∆∞·ª£ng & OCR -->
  <script>
    let modelPromise = cocoSsd.load();

    async function detectObjects() {
      const imageCanvas = document.getElementById('canvas');
      const overlayCanvas = document.getElementById('overlay');
      const ctx = overlayCanvas.getContext('2d');

      overlayCanvas.width = imageCanvas.width;
      overlayCanvas.height = imageCanvas.height;

      const model = await modelPromise;
      const imageDataURL = imageCanvas.toDataURL('image/jpeg');
      const image = new Image();
      image.src = imageDataURL;

      image.onload = async () => {
        ctx.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);
        const predictions = await model.detect(image);

        ctx.lineWidth = 2;
        ctx.strokeStyle = '#00FFFF';
        ctx.font = '16px Inter';
        ctx.fillStyle = '#00FFFF';

        predictions.forEach(pred => {
          const [x, y, width, height] = pred.bbox;
          ctx.strokeRect(x, y, width, height);
          ctx.fillText(pred.class, x, y > 10 ? y - 5 : y + 15);
        });

        console.log(predictions);
      };
    }

    async function performOCR() {
      const canvas = document.getElementById('canvas');
      const ocrResult = document.getElementById('ocrResult');
      ocrResult.innerText = '‚è≥ ƒêang nh·∫≠n di·ªán vƒÉn b·∫£n...';

      try {
        const result = await Tesseract.recognize(
          canvas,
          'eng', // C√≥ th·ªÉ d√πng 'vie+eng' n·∫øu t·∫£i th√™m ti·∫øng Vi·ªát
          { logger: m => console.log(m) }
        );
        ocrResult.innerText = `üìÑ K·∫øt qu·∫£:\n${result.data.text.trim()}`;
      } catch (err) {
        console.error(err);
        ocrResult.innerText = '‚ùå L·ªói khi nh·∫≠n di·ªán vƒÉn b·∫£n.';
      }
    }
  </script>
</body>
</html>
